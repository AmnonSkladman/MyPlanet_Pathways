<!DOCTYPE html>

<html>
<head>
<script lang="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.11.3/xlsx.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>

<body>

<input onchange="openFiles(this.files)" type="file" multiple accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" ID="fileSelect" runat="server"  /> 
<img id="output"/>
<button onclick="getData()">Get Request</button>

</body>

<script>

function sendData(dataFiles) {
    console.log(dataFiles)
    $.post('http://localhost:3000/api/upload', {data: dataFiles}, function(data, status) {
        console.log(status)
    })
}

function getData() {
    $.get('http://localhost:3000/api?city=toronto', function(data, status) {
        console.log(data, status)
    })
}

function openFiles(files) {
    console.log(files)
    var numFiles = Object.keys(files).length;
    var dataFiles = []

    Object.keys(files).forEach(i => {
        var reader = new FileReader()
        console.log(files[i].name)
        reader.readAsDataURL(files[i])

        reader.onload = function(event){
            dataFiles.push({name: files[i].name, content: event.target.result})
            if (dataFiles.length === numFiles) {
                sendData(dataFiles)
            }
        };
    })
}

</script>
</html>
